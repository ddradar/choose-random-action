import{appendFileSync as w,existsSync as $}from"node:fs";import{EOL as c}from"node:os";function p(t,e){process.stdout.write(`::${t}::${e}${c}`)}function i(t){p("debug",t)}function f(t){process.stdout.write(`${t}${c}`)}function a(t){p("error",t)}function m(t,e){let r="GITHUB_OUTPUT",o=process.env[r];if(!o||!$(o))throw new Error(`${r} environment variable is not set or file does not exist.`);w(o,`${t}=${e}${c}`,{encoding:"utf8"})}function g(t,e=!1){let r=process.env[`INPUT_${t.replace(/ /g,"_").toUpperCase()}`]??"";if(e&&!r)throw new Error(`${t} is required.`);return r.split(`
`).map(o=>o.trim()).filter(o=>o)}function l(t,e){if(i(`choices: ${JSON.stringify(t)}`),i(`Math.random(): ${e}`),isNaN(e)||e<0||1<=e)throw RangeError("random arg should be 0 <= random < 1.");let r=t.sort((n,s)=>s.weight-n.weight),o=t.reduce((n,s)=>n+s.weight,0),h=Math.floor(e*o)+1;i(`Choice: ${h}`);let u=0;for(let n of r)if(u+=n.weight,u>=h)return n.content;throw new RangeError("invalid choices.weight")}function d(){let t=g("contents",!0),e=g("weights").map(r=>parseInt(r.trim(),10));if(t.length===0)throw new Error("contents is required.");if(e.length===0)return t.map(r=>({content:r,weight:1}));if(e.some(r=>isNaN(r)||r<=0))throw new Error("weights should be natural number.");if(t.length!==e.length)throw new RangeError(`Parameters should be the same length. (contents: ${t.length} weights: ${e.length})`);return t.map((r,o)=>({content:r,weight:e[o]}))}function v(){try{let t=l(d(),Math.random());f(`selected: ${t}`),m("selected",t)}catch(t){process.exitCode=1,a(t instanceof Error?t.toString():`${t}`)}}v();export{v as run};
